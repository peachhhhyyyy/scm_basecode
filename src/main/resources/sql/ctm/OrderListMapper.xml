<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.happyjob.study.ctm.dao.OrderListDao">

   <!-- 제품 목록 조회 -->
  <select id="listProduct" resultType = "kr.happyjob.study.ctm.model.OrderListModel">
      SELECT sp.product_cd
           , lc.l_ct_nm
           , mc.m_ct_nm
           , sp.prod_nm
           , sp.detail
           , sp.price 
        FROM tb_scm_product sp
        LEFT OUTER JOIN tb_scm_m_category mc ON sp.m_ct_cd = mc.m_ct_cd
        LEFT OUTER JOIN tb_scm_l_category lc ON mc.l_ct_cd = lc.l_ct_cd
      <where>
      <if test="(sname != null) and (!sname.equals(''))">
      <choose>
        <when test="oname eq 'all'.toString()">
            AND (lc.l_ct_nm LIKE CONCAT('%', #{sname}, '%')
              or sp.prod_nm LIKE CONCAT('%', #{sname}, '%') 
              or sp.product_cd LIKE CONCAT('%', #{sname}, '%'))
        </when>
        <when test= "(oname eq 'product_l_ct'.toString())">
            AND lc.l_ct_nm LIKE concat('%', #{sname}, '%')
        </when>
        <when test= "(oname eq 'product_nm'.toString())">
            AND sp.prod_nm LIKE concat('%', #{sname}, '%')
        </when> 
        <when test= "(oname eq 'product_cd'.toString())">
            AND sp.product_cd LIKE concat('%', #{sname}, '%')
        </when>  
      </choose>
      </if> 
    </where>
      LIMIT #{pageIndex}, #{pageSize}
  </select>
  
  <!-- 제품 개수 카운트 -->
  <select id="totalCntProduct"  resultType="int">
      SELECT COUNT(1) AS tot_cnt 
        FROM tb_scm_product sp
        LEFT OUTER JOIN tb_scm_m_category mc ON sp.m_ct_cd = mc.m_ct_cd
        LEFT OUTER JOIN tb_scm_l_category lc ON mc.l_ct_cd = lc.l_ct_cd
      <where>
      <if test="(sname != null) and (!sname.equals(''))">
      <choose>
        <when test="oname eq 'all'.toString()">
            AND (lc.l_ct_nm LIKE CONCAT('%', #{sname}, '%')
              or sp.prod_nm LIKE CONCAT('%', #{sname}, '%') 
              or sp.product_cd LIKE CONCAT('%', #{sname}, '%'))
        </when>
        <when test= "(oname eq 'product_l_ct'.toString())">
            AND lc.l_ct_nm LIKE concat('%', #{sname}, '%')
        </when>
        <when test= "(oname eq 'product_nm'.toString())">
            AND sp.prod_nm LIKE concat('%', #{sname}, '%')
        </when> 
        <when test= "(oname eq 'product_cd'.toString())">
            AND sp.product_cd LIKE concat('%', #{sname}, '%')
        </when> 
      </choose>
      </if> 
    </where>
  </select>
  
</mapper> 